<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Automated E2E API Testing and Documentation for Node.js &#8211; Hardcore trial & error</title>
<meta name="description" content="A guide to setting up end-to-end API testing with Mocha and automated documentation generation with APIDoc for Node.js projects.">
<meta name="keywords" content="nodejs, testing, mocha, api, documentation">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/mocha.jpg">
<meta name="twitter:title" content="Automated E2E API Testing and Documentation for Node.js">
<meta name="twitter:description" content="A guide to setting up end-to-end API testing with Mocha and automated documentation generation with APIDoc for Node.js projects.">
<meta name="twitter:creator" content="@jestersimpps">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Automated E2E API Testing and Documentation for Node.js">
<meta property="og:description" content="A guide to setting up end-to-end API testing with Mocha and automated documentation generation with APIDoc for Node.js projects.">
<meta property="og:url" content="http://localhost:4001/automated-e2e-api-testing-documentation-for-nodejs/">
<meta property="og:site_name" content="Hardcore trial & error">

<link rel="canonical" href="http://localhost:4001/automated-e2e-api-testing-documentation-for-nodejs/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Hardcore trial & error Feed">

<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/assets/css/main.css">
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>


<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/bio-photo.png" alt="Jester Simpps photo" class="author-photo">
					<h4>Jester Simpps</h4>
					<p></p>
				</li>
				<li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:jestersimpps@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/jestersimpps"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://linkedin.com/in/jo-vinkenroye/63/a79/459"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/jestersimpps"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="http://instagram.com/jestersimpps"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
	</ul>
</nav>



<div class="entry-header">
  <div class="entry-image">
    <img src="/images/mocha.jpg" alt="Automated E2E API Testing and Documentation for Node.js">
  </div>
</div>


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title"><a href="/automated-e2e-api-testing-documentation-for-nodejs/" rel="bookmark" title="Automated E2E API Testing and Documentation for Node.js">Automated E2E API Testing and Documentation for Node.js</a></h1>
        <h2><span class="entry-date date published"><time datetime="2016-07-22T00:00:00+02:00">July 22, 2016</time></span></h2>
        
        
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          Reading time ~7 minutes
        </p>
      </div>
    </header>
    <div class="entry-content">
      <p>This was my first time doing test driven API development in Node.js and I must say, I really enjoyed it. I used to fall back on a Chrome plugin called <a href="https://www.getpostman.com/">Postman</a> a lot before getting used to Mocha and test driven development. It was a joy to write code for a test that described what the endpoint should do before actually coding the new endpoint. It made me think more about the code I was going to write and what it should do. It also happened sometimes that there would be a total API overhaul (like the implementation of softdeletes). And, man was I glad I had written unit tests for all my endpoints when that happened!</p>

<h2 id="butwait-wont-i-lose-a-lot-of-time-doing-that">But…wait.. won’t I lose a lot of time doing that?!?</h2>

<p><img src="https://risingstack-blog.s3-eu-west-1.amazonaws.com/2014/Oct/unit_testing.jpeg" alt="unit tests" /></p>

<p>Writing API tests for a node.js API can be a tedious job. We are dealing with a single event loop, so we need to take in account callbacks. Especially when doing API testing, callbacks can quickly become a pain point. A lot of times, checking whether requests work means triggering other requests sequentially to see if the database was updated by previous requests. This is why, after refactoring a bit of my tests, I was able to create a simple end-to-end testscript that I would just call whenever I wrote a new route. Every time with different input data specific to the route of course. I was later able to tie in APIDoc, a documentation generator that will create a frontend containing the documentation for all your endpoints. So in the end all my endpoints were not only fully tested, but also automatically documented in one go. This was very nice and saved me a lot of time.</p>

<h2 id="dependencies">Dependencies</h2>

<h3 id="testing">Testing</h3>

<ul>
  <li>We will be using <a href="https://mochajs.org/">Mocha</a> as a testing framework for our Node.js API.</li>
  <li>Mocha is great, but not perfect, so on top of it, we will include the <a href="https://github.com/visionmedia/supertest">supertest</a> package that will provide abstraction for HTTP testing.</li>
  <li>As I refactored my end to end tests into one single testscript, we will also need a package called <a href="https://www.npmjs.com/package/partial-compare">partial compare</a> that will do partial matching between test objects and actual return-objects from the api.</li>
  <li>We will also use <a href="https://www.npmjs.com/package/should">should</a> to make our testing code more human readable and easier to write.</li>
</ul>

<h3 id="api-documentation">API documentation</h3>

<ul>
  <li>A great library called <a href="http://apidocjs.com/">APIdoc</a> will take care of documenting all of the endpoints</li>
  <li>A plugin of that library <a href="https://www.npmjs.com/package/apidoc-plugin-schema">apidoc-plugin-schema</a> will make our life easier.</li>
</ul>

<p>In the package.json file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"apidoc-plugin-schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"body-parser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~1.8.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jsonfile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.3.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"mocha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"partial-compare"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.12.7"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~4.6.2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"supertest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.15.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type-of-is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.4.0"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="end-to-end-testing">End to end testing</h2>

<p>Wikipedia says:</p>

<blockquote>
  <p>End-to-end testing is a technique used to test whether the flow of an application right from start to finish is behaving as expected. The purpose of performing end-to-end testing is to identify system dependencies and to ensure that the data integrity is maintained between various system components and systems.</p>
</blockquote>

<p>Translate this to API testing and you get:</p>

<ol>
  <li>GET an array of existing data</li>
  <li>POST some new data</li>
  <li>Test if the new data was posted</li>
  <li>Change the new data using PUT</li>
  <li>Test if the new data was changed</li>
  <li>DELETE the new data</li>
  <li>Test if the new data was removed</li>
</ol>

<p>Of course this is the most simple scenario of RESTful API testing, and I know there’s some other endpoints that can be more complex (like counters, searches, etc.) But I will not elaborate on these in this post as these most of the time imply writing custom tests.</p>

<h2 id="a-test-script-that-covers-multiple-endpoints">A test script that covers multiple endpoints</h2>

<p>Because the sequence of testing is the same for all endpoints, I created a general script that will test different endpoints using the same code but different input based on the endpoint’s data. The input data will be stored in an object that will be called from an endpoint file in the ‘test/routes’ folder.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── <span class="nb">test</span>
|    ├── routes
|         ├── endpoint1.js
|         ├── endpoint2.js
|         ├── endpoint3.js
|    ├── e2e_tests.js
|    ├── schema_generator.js
</code></pre></div></div>

<p>The content of the endpoint file will contain the e2e_test options object which has some options for the endpoint tests and apidoc generator.
Next to the options, a testData object contains all data needed to perform the tests. The object attributes are pretty self explanatory:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">e2e</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./e2e_tests.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>

<span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="na">api</span><span class="p">:</span> <span class="nx">app</span><span class="p">,</span>
    <span class="na">apidoc</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">schemaDir</span><span class="p">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">`/../data/apischemas/`</span>
  <span class="p">}</span>


  <span class="kd">let</span> <span class="nx">testData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">routeName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Articles</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">postObject</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">this is an article</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">expectedObjectAfterPost</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">this is an article</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">putObject</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">this is an article too</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">expectedObjectAfterPut</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">this is an article too</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nf">e2e</span><span class="p">(</span><span class="nx">testData</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>


<span class="p">})();</span>
</code></pre></div></div>

<p>When we run mocha the end-to-end script will be called and run all tests for that endpoint. If you have specified a schemaDir and the apidoc boolean is set to true, the script will also automatically generate json schemas for the apidoc based on the testData.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_modules/.bin/mocha
</code></pre></div></div>

<p>Console output for a working API should be similar to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--------</span> Albums tests <span class="nt">--------</span>

GET /Albums 200 148.080 ms - 2
Counting Albums: 0
    ✓ Should <span class="k">return </span>an array of Albums
<span class="nt">--POST</span> shows/: <span class="o">{</span><span class="s2">"general"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"Ascot"</span><span class="o">}</span>,<span class="s2">"time"</span>:<span class="o">{</span><span class="s2">"startDate"</span>:<span class="s2">"2016-04-06T21:51:15.000Z"</span><span class="o">}</span>,<span class="s2">"type"</span>:<span class="s2">"album"</span><span class="o">}</span>
POST /Albums 200 151.935 ms - 1996
Adding: 1 Album
    ✓ Should create a new Album
GET /Albums/5789159e34150fe84c463f28 200 117.938 ms - 1996
    ✓ Should get the new Album
GET /Albums 200 103.512 ms - 1998
Counting Albums: 1, should be: 1
    ✓ Should <span class="k">return </span>an array of Albums with the correct size
PUT /Albums/5789159e34150fe84c463f28 200 115.422 ms - 1997
    ✓ Should change a Album
GET /Albums/5789159e34150fe84c463f28 200 102.205 ms - 1997
    ✓ Should get the changed Album
DELETE /Albums/5789159e34150fe84c463f28 200 116.241 ms - 2018
Removing: 1 Album
    ✓ Should remove a Album
GET /Albums 200 104.573 ms - 2
Counting Albums: 0, should be: 0
    ✓ Should get an array without the deleted Album

<span class="nt">--------</span> Articles tests <span class="nt">--------</span>

GET /Articles 200 92.230 ms - 2
Counting Articles: 0
    ✓ Should <span class="k">return </span>an array of Articles
POST /Articles 200 98.047 ms - 300
Adding: 1 Article
    ✓ Should create a new Article
GET /Articles/578915a134150fe84c463f39 200 99.768 ms - 300
    ✓ Should get the new Article
GET /Articles 200 107.985 ms - 302
Counting Articles: 1, should be: 1
    ✓ Should <span class="k">return </span>an array of Articles with the correct size
DELETE /Articles/578915a134150fe84c463f39 200 99.193 ms - 329
Removing: 1 Article
    ✓ Should remove a Article
GET /Articles 200 101.275 ms - 304
Counting Articles: 0, should be: 0
    ✓ Should get an array without the deleted Article


  2 passing <span class="o">(</span>4s<span class="o">)</span>

info: Done.
</code></pre></div></div>

<h2 id="api-documentation-generator">API documentation generator</h2>

<p>In your route files, above your endpoints, you can then add the following comment blocks:</p>

<ul>
  <li><a href="https://github.com/jestersimpps/node_rest_test_doc/blob/master/test/routes/APIDOC.md">api doc helpers</a></li>
</ul>

<p>Change them according to your endpoints of course. They will be used by the APIdoc generator to create the documentation frontend.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* @apiSchema {jsonschema=../test/data/apischemas/&lt;routecaps&gt;-POST-create-a-new-&lt;routesingle&gt;-PARAMS.json} apiParam
* @apiSchema {jsonschema=../test/data/apischemas/&lt;routecaps&gt;-POST-create-a-new-&lt;routesingle&gt;-SUCCESS.json} apiSuccess
*/</span>
</code></pre></div></div>

<p>The apiSchema references in the comments displayed above will point at the schema jsons that are generated by the <a href="https://github.com/jestersimpps/node_rest_test_doc/blob/master/test/schema_generator.js">schema_generator</a>.
The output directory can be changed in the options object in the endpoint test file as illustrated earlier.</p>

<p>Assuming the <code class="language-plaintext highlighter-rouge">./routes</code> folder contains your api’s route files and the <code class="language-plaintext highlighter-rouge">./public</code> folder is the folder that will contain the apidoc frontend, generate your api documentation by running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apidoc <span class="nt">-i</span> ./routes <span class="nt">-o</span> ./public/
</code></pre></div></div>

<ul>
  <li>These tests were run using mongoDB, which uses <code class="language-plaintext highlighter-rouge">_id</code> as a primary key. You might have to edit the test script to your needs a bit when you are using a different database or key/slug to perform individual GET,PUT,DELETE requests.</li>
  <li>In the e2e_test script, basic authentication was used. You might also need to change this according to the authentication methods of your API.</li>
</ul>

<p>The entire code and scripts can be found <a href="https://github.com/jestersimpps/node_rest_test_doc">here</a></p>

      <footer class="entry-meta">
        <span class="entry-tags">
          
            <a href="/tags/#nodejs" title="Posts tagged nodejs" class="tag">nodejs</a>
          
            <a href="/tags/#testing" title="Posts tagged testing" class="tag">testing</a>
          
            <a href="/tags/#mocha" title="Posts tagged mocha" class="tag">mocha</a>
          
            <a href="/tags/#api" title="Posts tagged api" class="tag">api</a>
          
            <a href="/tags/#documentation" title="Posts tagged documentation" class="tag">documentation</a>
          
        </span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4001/automated-e2e-api-testing-documentation-for-nodejs/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=Automated E2E API Testing and Documentation for Node.js&url=http://localhost:4001/automated-e2e-api-testing-documentation-for-nodejs/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
          </ul>
        </div>
      </footer>
    </div>
  </article>
</div>

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2026 Jester Simpps. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67531656-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


</body>
</html>
